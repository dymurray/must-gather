#!/bin/bash
source pwait
max_parallelism=10
logs_since="72h"

# Cluster passed in from main gather
cluster=$1
namespaces=$2
logs_since=$3

# Collect all Pod logs from namespaces where MTC is installed
for ns in ${namespaces[@]}; do
  # Gather Pod associated logs
  /usr/bin/gather_logs_pods ${cluster} ${ns} ${logs_since} ${max_parallelism} &

  # Gather Backup associated logs
  /usr/bin/gather_logs_backups ${cluster} ${ns} ${logs_since} ${max_parallelism} &

  # Gather Restore associated logs
  /usr/bin/gather_logs_restores ${cluster} ${ns} ${logs_since} ${max_parallelism} &
  
  # Gather PodVolumeRestore associated logs
  /usr/bin/gather_logs_pvrs ${cluster} ${ns} ${logs_since} ${max_parallelism} &

  # Gather PodVolumeBackup associated logs
  /usr/bin/gather_logs_pvbs ${cluster} ${ns} ${logs_since} ${max_parallelism} &
done

# Wait for all background jobs to complete
wait